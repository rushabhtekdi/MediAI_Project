<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MediAI - Medical Report Analyzer</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      color: #333;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f5f7fa;
    }
    h1 {
      color: #2c3e50;
      text-align: center;
      margin-bottom: 30px;
    }
    h2 {
      color: #3498db;
      margin-top: 25px;
    }
    .container {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      padding: 25px;
      margin-bottom: 30px;
    }
    .upload-box {
      border: 2px dashed #ddd;
      border-radius: 8px;
      padding: 40px;
      text-align: center;
      margin: 20px 0;
      position: relative;
      transition: all 0.3s;
    }
    .upload-box:hover {
      border-color: #3498db;
    }
    .upload-box input[type="file"] {
      opacity: 0;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      cursor: pointer;
    }
    .upload-icon {
      font-size: 48px;
      margin-bottom: 15px;
      color: #7f8c8d;
    }
    .file-info {
      margin-top: 15px;
      display: none;
    }
    .file-name {
      font-weight: bold;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }
    button {
      background-color: #3498db;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.2s;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover {
      background-color: #2980b9;
    }
    .analyze-btn {
      background-color: #2ecc71;
      display: none;
    }
    .analyze-btn:hover {
      background-color: #27ae60;
    }
    .clear-btn {
      background-color: #7f8c8d;
      display: none;
    }
    .clear-btn:hover {
      background-color: #95a5a6;
    }
    #response {
      background-color: #f9f9f9;
      border-left: 4px solid #3498db;
      padding: 15px;
      margin-top: 20px;
      white-space: pre-wrap;
      line-height: 1.7;
    }
    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #3498db;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    .disclaimer {
      font-size: 14px;
      color: #7f8c8d;
      margin-top: 30px;
      border-top: 1px solid #ddd;
      padding-top: 15px;
    }
    .error {
      color: #e74c3c;
      font-weight: bold;
    }
    .medical-term {
      color: #3498db;
      text-decoration: underline;
      cursor: help;
    }
    .simplified-term {
      background-color: #e8f4fc;
      padding: 2px 5px;
      border-radius: 3px;
      font-style: italic;
    }
    .result-container {
      margin-top: 30px;
    }
    .nav-buttons {
      display: flex;
      justify-content: center;
      margin: 20px 0;
    }
    .glossary {
      margin-top: 30px;
    }
    .glossary-term {
      font-weight: bold;
      color: #3498db;
    }
    .glossary-def {
      margin-bottom: 15px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>MediAI â€“ Medical Report Analyzer</h1>
    
    <div class="nav-buttons">
      <button onclick="window.location.href='/'">Symptom Checker</button>
      <button onclick="window.location.href='/bmi-calculator'">BMI Calculator</button>
      <button onclick="window.location.href='/medical-facilities'">Find Medical Help</button>
    </div>
    
    <h2>Upload Medical Report</h2>
    <p>Upload your medical report to get an easy-to-understand analysis and explanation of medical terms:</p>
    
    <div class="upload-box" id="uploadBox">
      <input type="file" id="reportFile" accept=".pdf,.doc,.docx,.jpg,.jpeg,.png" onchange="handleFileSelect(this)">
      <div class="upload-icon">ðŸ“„</div>
      <p>Click or drag a file here to upload</p>
      <p><small>Supported formats: PDF, Word (DOC/DOCX), Images (JPG, PNG)</small></p>
    </div>
    
    <div class="file-info" id="fileInfo">
      <p>Selected file: <span class="file-name" id="fileName"></span></p>
    </div>
    
    <div>
      <button class="analyze-btn" id="analyzeBtn" onclick="analyzeReport()">Analyze Report</button>
      <button class="clear-btn" id="clearBtn" onclick="clearReport()">Clear</button>
    </div>
    
    <div class="loading" id="loadingIndicator">
      <div class="loading-spinner"></div>
      <p>Analyzing your medical report...</p>
    </div>

    <div class="result-container">
      <h2>Analysis Results:</h2>
      <div id="response">Upload a medical report and click "Analyze Report" to get started.</div>
    </div>
    
    <div class="disclaimer">
      <p><strong>Important:</strong> This tool is for informational purposes only and not a substitute for professional medical advice. The analysis may not capture all important details in your medical report. Always consult with your healthcare provider to properly understand your medical reports and test results.</p>
    </div>
  </div>
  
  <script>
    function handleFileSelect(fileInput) {
      const file = fileInput.files[0];
      if (file) {
        document.getElementById('fileName').textContent = file.name;
        document.getElementById('fileInfo').style.display = 'block';
        document.getElementById('analyzeBtn').style.display = 'inline-block';
        document.getElementById('clearBtn').style.display = 'inline-block';
        
        // Visual feedback on upload box
        document.getElementById('uploadBox').style.borderColor = '#2ecc71';
      }
    }
    
    function clearReport() {
      document.getElementById('reportFile').value = '';
      document.getElementById('fileInfo').style.display = 'none';
      document.getElementById('analyzeBtn').style.display = 'none';
      document.getElementById('clearBtn').style.display = 'none';
      document.getElementById('response').innerHTML = 'Upload a medical report and click "Analyze Report" to get started.';
      document.getElementById('uploadBox').style.borderColor = '#ddd';
    }
    
    function analyzeReport() {
      const fileInput = document.getElementById('reportFile');
      const file = fileInput.files[0];
      
      if (!file) {
        document.getElementById('response').innerHTML = '<span class="error">Please select a file first.</span>';
        return;
      }
      
      // Check file size - limit to 10MB
      if (file.size > 10 * 1024 * 1024) {
        document.getElementById('response').innerHTML = '<span class="error">File too large. Please upload files smaller than 10MB.</span>';
        return;
      }
      
      // Show loading indicator
      document.getElementById('loadingIndicator').style.display = 'block';
      document.getElementById('response').innerHTML = '';
      
      // Prepare form data
      const formData = new FormData();
      formData.append('report', file);
      
      // Send file to server
      fetch('/analyze-report', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        document.getElementById('loadingIndicator').style.display = 'none';
        
        if (data.result) {
          document.getElementById('response').innerHTML = data.result;
          
          // Add tooltip functionality for medical terms if needed
          const medicalTerms = document.querySelectorAll('.medical-term');
          // Add tooltip behavior here if desired
        } else {
          document.getElementById('response').innerHTML = '<span class="error">Error: ' + (data.error || 'Unknown error occurred') + '</span>';
        }
      })
      .catch(err => {
        document.getElementById('loadingIndicator').style.display = 'none';
        document.getElementById('response').innerHTML = '<span class="error">Network error: ' + err.message + '</span>';
      });
    }
  </script>
</body>
</html>